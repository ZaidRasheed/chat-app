import{useChatData as v}from"./FindChat.de8f9646.js";import{H as N}from"./Header.d37665be.js";import{A as w}from"./Home.c9f168ed.js";import{b as e,F as y,j as i,r as x,u as g}from"./index.3e47384e.js";function M({name:a,message:r,received:l,url:c,date:o,online:d}){const u={year:"numeric",month:"long",day:"numeric"},m=new Date,n=new Date(o.seconds*1e3);let t;if(n.getDate()===m.getDate()){const s=n.getHours(),f=n.getMinutes()<10?`0${n.getMinutes()}`:n.getMinutes(),h=s>=12;t=(h?s%12:s)+":"+f+(h?" PM":" AM")}else t=n.toLocaleDateString("en",u);return e(y,{children:l?i("div",{className:"message mb-4 flex",children:[e("div",{className:"flex-2",children:i("div",{className:"w-12 h-12 relative",children:[e(w,{size:"1",name:a,url:c}),e("span",{className:`absolute w-4 h-4 bg-${d?"green":"gray"}-400 rounded-full right-0 bottom-0 border-2 border-white`})]})}),i("div",{className:"flex-1 px-2",children:[e("div",{className:"inline-block bg-gray-300 rounded-full p-2 px-6 text-gray-700",children:e("span",{children:r})}),e("div",{className:"pl-4",children:e("small",{className:"text-gray-500",children:t})})]})]}):e("div",{className:"message me mb-4 flex text-right",children:i("div",{className:"flex-1 px-2",children:[e("div",{className:"inline-block bg-blue-600 rounded-full p-2 px-6 text-white",children:e("span",{children:r})}),e("div",{className:"pr-4",children:e("small",{className:"text-gray-500",children:t})})]})})})}function D(a,r){const l=x.exports.useRef(null),c=x.exports.useRef(null),[o,d]=x.exports.useState({name:"",profilePictureURL:"",userId:""}),{sendMessage:u,openMessages:m}=g();x.exports.useEffect(()=>{if(a){const{userInfo:s}=a==null?void 0:a.data()[r],{firstName:f,lastName:h,profilePictureURL:p,userId:b}=s;d({name:f+" "+h,profilePictureURL:p,userId:b}),setTimeout(()=>{n()},300)}try{m(r)}catch(s){console.log(s)}},[a]);function n(){var s;(s=c.current)==null||s.scrollIntoView()}async function t(s){if(s.preventDefault(),!(l!=null&&l.current)||!(l!=null&&l.current.value)||!l.current.value.trim())return;const f=l.current.value;await u(f,r,o.userId),n(),l.current.value="",l.current.focus()}return{messageRef:l,info:o,handleSendMessage:t,bottomRef:c}}function j({chats:a}){const{onlineStatus:r}=g(),{chat:l,chatId:c}=v(),{info:o,messageRef:d,handleSendMessage:u,bottomRef:m}=D(a,c),n=r==null?void 0:r.get(a==null?void 0:a.data()[c].userInfo.userId).connected;return e("div",{className:"flex-1 bg-gray-100 w-full h-full ",children:i("div",{className:"main-body container m-auto w-11/12 h-full flex flex-col relative",children:[e(N,{}),i("div",{className:"flex-3 mb-8 border-b-2 border-gray-200",children:[i("h2",{className:"text-xl py-1",children:["Chatting with ",e("b",{children:o.name})]}),i("p",{className:"text-gray-500 text-[10px] hidden sm:block",children:["ID: ",c]})]}),e("div",{className:"main flex-1 flex flex-col mb-28 overflow-auto ",children:e("div",{children:e("div",{className:"chat-area flex-1 flex flex-col lg:block ",children:i("div",{className:"messages flex-1 ",children:[l==null?void 0:l.messages.sort((t,s)=>t.date.seconds-s.date.seconds).map(t=>{const s=o.userId===t.senderId;return e(M,{online:n,date:t.date,received:s,message:t.content,name:o.name,url:o.profilePictureURL},t.date)}),e("div",{ref:m})]})})})}),e("div",{className:"flex-2 pt-4 pb-10 absolute w-full bottom-0",children:e("div",{className:"write bg-white shadow flex rounded-lg",children:i("form",{className:"flex w-full",onSubmit:u,children:[e("div",{className:"flex-1 flex items-center justify-center",children:(l==null?void 0:l.active)!==!1?e("textarea",{name:"message",ref:d,className:"w-full block outline-none py-4 px-4 bg-transparent",rows:1,placeholder:"Type a message...",autoFocus:!0}):e("input",{name:"message",disabled:!0,readOnly:!0,value:"You can no longer message this user as the account has been deleted",className:"w-full block outline-none py-4 px-4 bg-transparent text-red-600 font-medium	",placeholder:"Type a message...",autoFocus:!0})}),e("div",{className:"flex-2 w-16 p-3 flex content-center items-center",children:e("div",{className:"flex-1",children:e("button",{disabled:!(l!=null&&l.active),type:"submit",className:"disabled:opacity-50 disabled:cursor-no-drop hover:bg-blue-700 bg-blue-500 w-11 h-11 rounded-full inline-block",children:e("span",{className:"flex items-center justify-center align-text-bottom",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"text-white",viewBox:"0 0 18 18",children:e("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"})})})})})})]})})})]})})}export{j as default};
